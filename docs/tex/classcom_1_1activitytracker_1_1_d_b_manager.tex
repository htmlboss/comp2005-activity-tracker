\hypertarget{classcom_1_1activitytracker_1_1_d_b_manager}{}\section{com.\+activitytracker.\+D\+B\+Manager Class Reference}
\label{classcom_1_1activitytracker_1_1_d_b_manager}\index{com.\+activitytracker.\+D\+B\+Manager@{com.\+activitytracker.\+D\+B\+Manager}}


Collaboration diagram for com.\+activitytracker.\+D\+B\+Manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{classcom_1_1activitytracker_1_1_d_b_manager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_ac390a33d3547306b250c8a9ed370997c}{create\+User}} (final String name, final String email\+Address, final java.\+util.\+Date dateof\+Birth, final User.\+Sex sex, final float height, final float weight, final \mbox{\hyperlink{classcom_1_1activitytracker_1_1_secure_string}{Secure\+String}} secure\+Password)  throws Assertion\+Error 
\item 
boolean \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_af05d79f33ecf2920a67d1b9cf82c079f}{user\+Exists}} (final String email\+Address)
\item 
int \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a195dcdeabdd00facb19d720976dd3f53}{get\+User\+I\+D\+By\+Email}} (final String email\+Address)
\item 
String \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a20f726c054d6c8a6fc3ce629d87f1114}{get\+User\+String\+Attribute}} (final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} attribute, final int id)
\item 
float \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a98df66254bec4d74b29cfe468a9fc794}{get\+User\+Float\+Attribute}} (final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} attribute, final int id)
\item 
Date \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a0576baf67b45c7d2d0ba369052e4404e}{get\+Date\+Of\+Birth}} (final int id)
\item 
User.\+Sex \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a4e695c111b877cfd1d918602551f65a1}{get\+User\+Sex}} (final int id)
\item 
byte \mbox{[}$\,$\mbox{]} \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_aeab864b072cc08c0521e80ae1f459ca7}{get\+User\+Pass\+Salt}} (final int id)
\item 
int \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_aab14c61b3f3a17bdea10cab1b5fd9337}{get\+User\+Last\+R\+ID}} (final int id)
\item 
void \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a93b7fc4c2d0083e125852d84f087a8d3}{set\+User\+Last\+R\+ID}} (final int id, final int last\+R\+ID)
\item 
int \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_ae0504a939b6f165aa5c3cca9eb8df049}{new\+Run}} (final int user\+ID, final java.\+util.\+Date date, final float duration, final float distance, final float altitude\+Ascended, final float altitude\+Descended)
\item 
void \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_aa088e156858d8d661e2f43c1054c51c8}{set\+Run}} (final int r\+ID, final float duration, final float distance, final float altitude\+Ascended, final float altitude\+Descended)
\item 
float \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a666452f1e5862f90c06b0beb9a9fcfdd}{get\+Run\+Float\+Attribute}} (final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute}{Run\+Attribute}} attribute, final int r\+ID)
\item 
java.\+util.\+Date \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a1bef7a6f466db41b1a6da7a502d35bb9}{get\+Run\+Date}} (final int run\+ID)
\item 
boolean \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a723ac1c573bacdd0b62894357bd65a9b}{run\+Exists}} (final int r\+ID)
\item 
Vector$<$ Integer $>$ \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a48d9e51c1b73064b8f773cdde5113928}{get\+Runs}} (final int user\+ID, final java.\+util.\+Date start\+Date, final java.\+util.\+Date end\+Date)
\end{DoxyCompactItemize}
\subsection*{Package Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_ac1f558ef56fe02d74fe103a473a15bb5}{D\+B\+Manager}} ()
\item 
boolean \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a41df4600bb5901a26a4ea6a7108a70b9}{init}} (final String db\+U\+RL)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
Result\+Set \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_adef71a18dc05536d80e83311841e1953}{execute\+Query}} (final String sql\+Query)
\item 
boolean \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a382397e2bdf309901d1c80ff66be69b7}{execute\+Update}} (final String sql\+Query)
\item 
boolean \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_af9ab112f840e3c803b6b28a2f1a15215}{is\+Empty}} ()
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
Connection \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\+\_\+conn}} = null
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Singleton class for the database. All classes and methods that interact with the database will use a method in this class.

Many times we are faced with the \char`\"{}chicken and egg\char`\"{} problem where we wish to create an object that is populated with information from the database. So the question one faces is, "does the object\textquotesingle{}s constructor query the database (through the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} class, of course) for each attribute of the object that it wishes to retrieve, or do we directly interact with a \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} method which will then return a \mbox{\hyperlink{classcom_1_1activitytracker_1_1_user}{User}} or \mbox{\hyperlink{classcom_1_1activitytracker_1_1_run}{Run}} object, for example?" We have decided to use the former methodology, with \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} methods being as general as possible, and often accepting enum types which then are put into a switch to create the specific S\+QL query we wish to execute. This works best when all data returned is of the same data type (for example, the Workout class will have three float attributes at the time of writing so we use one method with return type of float for returning Workout attributes). This does not work as well when the object requires data of multiple types --- for example, the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_user}{User}} class. In this case, we have split the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} methods into a single method for each attribute being returned.

Polymorphism could theoretically be used here to simply have a return type of Object, however this is not flexible and requires casting {\itshape all} returned data to the correct type in the invoking method. 

Definition at line 30 of file D\+B\+Manager.\+java.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_ac1f558ef56fe02d74fe103a473a15bb5}\label{classcom_1_1activitytracker_1_1_d_b_manager_ac1f558ef56fe02d74fe103a473a15bb5}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!D\+B\+Manager@{D\+B\+Manager}}
\index{D\+B\+Manager@{D\+B\+Manager}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{D\+B\+Manager()}{DBManager()}}
{\footnotesize\ttfamily com.\+activitytracker.\+D\+B\+Manager.\+D\+B\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [package]}}

Creates a new \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} object.

This should only be called once, from the main program, as \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} is meant to be a {\itshape singleton} class.

This constructor takes no parameters as verification of the S\+Q\+Lite database is done in the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a41df4600bb5901a26a4ea6a7108a70b9}{init()}} method of this class, which returns information about whether the initialization was successful or not. 

Definition at line 47 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
47                 \{
48     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_ac390a33d3547306b250c8a9ed370997c}\label{classcom_1_1activitytracker_1_1_d_b_manager_ac390a33d3547306b250c8a9ed370997c}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!create\+User@{create\+User}}
\index{create\+User@{create\+User}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{create\+User()}{createUser()}}
{\footnotesize\ttfamily void com.\+activitytracker.\+D\+B\+Manager.\+create\+User (\begin{DoxyParamCaption}\item[{final String}]{name,  }\item[{final String}]{email\+Address,  }\item[{final java.\+util.\+Date}]{dateof\+Birth,  }\item[{final User.\+Sex}]{sex,  }\item[{final float}]{height,  }\item[{final float}]{weight,  }\item[{final \mbox{\hyperlink{classcom_1_1activitytracker_1_1_secure_string}{Secure\+String}}}]{secure\+Password }\end{DoxyParamCaption}) throws Assertion\+Error}

Adds a row for a user to the Users table in the S\+Q\+Lite database for the app.

Requires that the database tables exist and are in the correct format. If the user exists in the database this method raises an Assertion\+Error exception.


\begin{DoxyParams}{Parameters}
{\em name} & User\textquotesingle{}s name. \\
\hline
{\em email\+Address} & User\textquotesingle{}s email address; used to authenticate. \\
\hline
{\em dateof\+Birth} & The date the user was born. \\
\hline
{\em sex} & The user\textquotesingle{}s sex; is either \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_1_1_sex_ad3b626a38bd4615eb621d75b939f412d}{User.\+Sex.\+M\+A\+LE}} or \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_1_1_sex_a5c22ece8a4df71ed5202cd492990a752}{User.\+Sex.\+F\+E\+M\+A\+LE}}. \\
\hline
{\em height} & Floating point number of the user\textquotesingle{}s height in metres. \\
\hline
{\em weight} & Floating point number of the user\textquotesingle{}s weight in kilograms. \\
\hline
{\em secure\+Password} & A \mbox{\hyperlink{classcom_1_1activitytracker_1_1_secure_string}{Secure\+String}} object containing the user\textquotesingle{}s password, encrypted. \\
\hline
\end{DoxyParams}


Definition at line 64 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
66                                                                                     \{
67 
68         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_af05d79f33ecf2920a67d1b9cf82c079f}{userExists}}(emailAddress)) \{
69             String sqlQuery = \textcolor{stringliteral}{"INSERT INTO Users ("} +
70                     \textcolor{stringliteral}{"email\_address, "} +
71                     \textcolor{stringliteral}{"name, "} +
72                     \textcolor{stringliteral}{"date\_of\_birth, "} +
73                     \textcolor{stringliteral}{"sex, "} +
74                     \textcolor{stringliteral}{"height, "} +
75                     \textcolor{stringliteral}{"weight,"} +
76                     \textcolor{stringliteral}{"password\_hash,"} +
77                     \textcolor{stringliteral}{"password\_salt,"} +
78                     \textcolor{stringliteral}{"created\_at"} +
79                     \textcolor{stringliteral}{") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)"};
80             byte sexByte = sex.equals(User.Sex.MALE) ? (byte) 1 : (byte) 0;
81             java.sql.Date currentTime = \textcolor{keyword}{new} java.sql.Date(System.currentTimeMillis());
82 
83             \textcolor{keywordflow}{try} \{
84                 PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
85                 stmt.setString(1, emailAddress);
86                 stmt.setString(2, name);
87                 stmt.setLong(3, dateofBirth.getTime());
88                 stmt.setByte(4, sexByte);
89                 stmt.setFloat(5, height);
90                 stmt.setFloat(6, weight);
91                 stmt.setString(7, securePassword.toString());
92                 stmt.setBytes(8, securePassword.getSalt());
93                 stmt.setDate(9, currentTime);
94 
95                 \textcolor{keywordflow}{if} (stmt.executeUpdate() != 1) \{
96                     System.err.println(\textcolor{stringliteral}{"User not added to database."});
97                 \}
98 
99                 stmt.close();
100             \}
101             \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
102                 System.err.println(e.getMessage());
103             \}
104         \}
105         \textcolor{keywordflow}{else} \{
106             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} AssertionError(\textcolor{stringliteral}{"User with email address '"} + emailAddress + \textcolor{stringliteral}{"' already exists."});
107         \}
108     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_adef71a18dc05536d80e83311841e1953}\label{classcom_1_1activitytracker_1_1_d_b_manager_adef71a18dc05536d80e83311841e1953}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!execute\+Query@{execute\+Query}}
\index{execute\+Query@{execute\+Query}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{execute\+Query()}{executeQuery()}}
{\footnotesize\ttfamily Result\+Set com.\+activitytracker.\+D\+B\+Manager.\+execute\+Query (\begin{DoxyParamCaption}\item[{final String}]{sql\+Query }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}

A wrapper method for processing {\itshape safe} S\+QL queries.

By safe we mean that the S\+QL query string is entirely hard-\/coded in the program source code. In other words, no user input is added. This is an important distinction as the former may leave the application vulnerable to S\+QL injection.

In such cases, a S\+QL Prepared\+Statement should be used.


\begin{DoxyParams}{Parameters}
{\em sql\+Query} & The S\+QL code to be executed. Must be a {\itshape S\+E\+L\+E\+CT} statement.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a Result\+Set containing the returned row(s) and/or column(s) of the S\+QL query that was executed. 
\end{DoxyReturn}


Definition at line 732 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
732                                                           \{
733         ResultSet res = null;
734 
735         \textcolor{keywordflow}{try} \{
736             Statement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.createStatement();
737             res = stmt.executeQuery(sqlQuery);
738             stmt.close();
739         \}
740         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
741             System.err.println(e.getMessage());
742         \}
743 
744         \textcolor{keywordflow}{return} res;
745     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a382397e2bdf309901d1c80ff66be69b7}\label{classcom_1_1activitytracker_1_1_d_b_manager_a382397e2bdf309901d1c80ff66be69b7}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!execute\+Update@{execute\+Update}}
\index{execute\+Update@{execute\+Update}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{execute\+Update()}{executeUpdate()}}
{\footnotesize\ttfamily boolean com.\+activitytracker.\+D\+B\+Manager.\+execute\+Update (\begin{DoxyParamCaption}\item[{final String}]{sql\+Query }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}

A wrapper method for processing {\itshape safe} S\+QL queries.

By safe we mean that the S\+QL query string is entirely hard-\/coded in the program source code. In other words, no user input is added. This is an important distinction as the former may leave the application vulnerable to S\+QL injection.

In such cases, a S\+QL Prepared\+Statement should be used.


\begin{DoxyParams}{Parameters}
{\em sql\+Query} & The S\+QL code to be executed. Must be an {\itshape I\+N\+S\+E\+RT} or {\itshape U\+P\+D\+A\+TE} statement.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a boolean indicating if the query was successful. 
\end{DoxyReturn}


Definition at line 760 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
760                                                          \{
761         \textcolor{keywordflow}{try} \{
762             Statement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.createStatement();
763             stmt.executeUpdate(sqlQuery);
764             stmt.close();
765         \}
766         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
767             System.err.println(e.getMessage());
768             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
769         \}
770 
771         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
772     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a0576baf67b45c7d2d0ba369052e4404e}\label{classcom_1_1activitytracker_1_1_d_b_manager_a0576baf67b45c7d2d0ba369052e4404e}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+Date\+Of\+Birth@{get\+Date\+Of\+Birth}}
\index{get\+Date\+Of\+Birth@{get\+Date\+Of\+Birth}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+Date\+Of\+Birth()}{getDateOfBirth()}}
{\footnotesize\ttfamily Date com.\+activitytracker.\+D\+B\+Manager.\+get\+Date\+Of\+Birth (\begin{DoxyParamCaption}\item[{final int}]{id }\end{DoxyParamCaption})}

Retrieves the user\textquotesingle{}s date of birth (D\+OB) from the database.

At the time of writing, this method is only being used in the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_user}{User}} constructor.


\begin{DoxyParams}{Parameters}
{\em id} & Unique ID used to associate information in the database to this user.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a Date object containing the user\textquotesingle{}s D\+OB (i.\+e., year, month, day). 
\end{DoxyReturn}


Definition at line 294 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
294                                              \{
295         Date DOB;
296         java.sql.Date DOBResult;
297         ResultSet res;
298         String sqlQuery = \textcolor{stringliteral}{"SELECT date\_of\_birth FROM Users WHERE id=?"};
299         \textcolor{keywordflow}{try} \{
300             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
301             stmt.setInt(1, \textcolor{keywordtype}{id});
302             res = stmt.executeQuery();
303             DOBResult = res.getDate(\textcolor{stringliteral}{"date\_of\_birth"});
304 
305             stmt.close();
306         \}
307         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
308             System.err.println(e.getMessage());
309             \textcolor{keywordflow}{return} null;
310         \}
311         DOB = \textcolor{keyword}{new} Date(DOBResult.getYear(), DOBResult.getMonth(), DOBResult.getDay());
312 
313         \textcolor{keywordflow}{return} DOB;
314     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a1bef7a6f466db41b1a6da7a502d35bb9}\label{classcom_1_1activitytracker_1_1_d_b_manager_a1bef7a6f466db41b1a6da7a502d35bb9}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+Run\+Date@{get\+Run\+Date}}
\index{get\+Run\+Date@{get\+Run\+Date}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+Run\+Date()}{getRunDate()}}
{\footnotesize\ttfamily java.\+util.\+Date com.\+activitytracker.\+D\+B\+Manager.\+get\+Run\+Date (\begin{DoxyParamCaption}\item[{final int}]{run\+ID }\end{DoxyParamCaption})}

Retrieves a run\textquotesingle{}s date from the database using its unique ID


\begin{DoxyParams}{Parameters}
{\em run\+ID} & Unique ID corresponding to the row in the Runs table that we wish to query. \\
\hline
\end{DoxyParams}


Definition at line 627 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
627                                                       \{
628         ResultSet res;
629         \textcolor{keywordtype}{long} fromEpoch;
630         java.util.Date date = null;
631         \textcolor{keywordflow}{try} \{
632             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(\textcolor{stringliteral}{"SELECT date FROM Runs WHERE id=?"});
633             stmt.setInt(1, runID);
634             res = stmt.executeQuery();
635             fromEpoch = res.getLong(\textcolor{stringliteral}{"date"});
636             date = \textcolor{keyword}{new} java.util.Date(fromEpoch);
637         \}
638         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
639             System.err.println(e.getMessage());
640         \}
641 
642         \textcolor{keywordflow}{return} date;
643     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a666452f1e5862f90c06b0beb9a9fcfdd}\label{classcom_1_1activitytracker_1_1_d_b_manager_a666452f1e5862f90c06b0beb9a9fcfdd}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+Run\+Float\+Attribute@{get\+Run\+Float\+Attribute}}
\index{get\+Run\+Float\+Attribute@{get\+Run\+Float\+Attribute}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+Run\+Float\+Attribute()}{getRunFloatAttribute()}}
{\footnotesize\ttfamily float com.\+activitytracker.\+D\+B\+Manager.\+get\+Run\+Float\+Attribute (\begin{DoxyParamCaption}\item[{final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute}{Run\+Attribute}}}]{attribute,  }\item[{final int}]{r\+ID }\end{DoxyParamCaption})}

Retrieves a run\textquotesingle{}s attribute as a floating point number, where applicable, from the database.

This method accepts a \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute}{Run\+Attribute}} enumeration type to specify what attribute it is returning from the database. Only certain attributes are accepted by this method, namely those that are stored as real values. Attributes stored as other data types should use the appropriate accessor method.


\begin{DoxyParams}{Parameters}
{\em attribute} & The attribute that the method is supposed to query the DB for and return the value of. Note that only certain \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute}{Run\+Attribute}} types are supported in this method.
\begin{DoxyItemize}
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute_a7adf133b2a62f1f99ffc2adfb7097ec9}{Run\+Attribute.\+D\+U\+R\+A\+T\+I\+ON}}, the run\textquotesingle{}s duration is returned.
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute_a90ee541e68e458a0bb3f5ea45fd46ec0}{Run\+Attribute.\+D\+I\+S\+T\+A\+N\+CE}}, the run\textquotesingle{}s cumulative distance is returned in metres.
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute_abcfe85bf48187d67842a0525c1bcc0af}{Run\+Attribute.\+A\+L\+T\+I\+T\+U\+D\+E\+\_\+\+A\+S\+C\+E\+N\+D\+ED}}, the run\textquotesingle{}s cumulative altitude climbed is returned in metres
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_run_attribute_a337a68867cfdb8ec7a17c318ad8b216b}{Run\+Attribute.\+A\+L\+T\+I\+T\+U\+D\+E\+\_\+\+D\+E\+S\+C\+E\+N\+D\+ED}}, the run\textquotesingle{}s cumulative altitude descended is returned in metres 
\end{DoxyItemize}\\
\hline
{\em r\+ID} & Unique ID corresponding to the row in the Runs table that we wish to query. If such an ID does not exist, {\itshape 0.\+0f} will be returned.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a float containing run attribute as specified by the {\itshape attribute} parameter. 
\end{DoxyReturn}


Definition at line 578 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
578                                                                                    \{
579         ResultSet res;
580         PreparedStatement stmt;
581         String sqlQuery, columnLabel;
582         \textcolor{keywordtype}{float} attrVal = 0.0f;
583         \textcolor{keywordflow}{switch} (attribute) \{
584             \textcolor{keywordflow}{case} DURATION:
585                 columnLabel = \textcolor{stringliteral}{"duration"};
586                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Runs WHERE id=?"};
587                 \textcolor{keywordflow}{break};
588             \textcolor{keywordflow}{case} DISTANCE:
589                 columnLabel = \textcolor{stringliteral}{"distance"};
590                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Runs WHERE id=?"};
591                 \textcolor{keywordflow}{break};
592             \textcolor{keywordflow}{case} ALTITUDE\_ASCENDED:
593                 columnLabel = \textcolor{stringliteral}{"altitude\_ascended"};
594                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Runs WHERE id=?"};
595                 \textcolor{keywordflow}{break};
596             \textcolor{keywordflow}{case} ALTITUDE\_DESCENDED:
597                 columnLabel = \textcolor{stringliteral}{"altitude\_descended"};
598                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Runs WHERE id=?"};
599                 \textcolor{keywordflow}{break};
600             \textcolor{keywordflow}{default}:
601                 \textcolor{keywordflow}{return} attrVal;
602         \}
603         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a723ac1c573bacdd0b62894357bd65a9b}{runExists}}(rID)) \{
604             \textcolor{keywordflow}{try} \{
605                 stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
606                 stmt.setInt(1, rID);
607                 res = stmt.executeQuery();
608                 attrVal = res.getFloat(columnLabel);
609             \}
610             \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
611                 System.err.println(e.getMessage());
612             \}
613         \}
614         \textcolor{keywordflow}{else} \{
615             System.err.println(\textcolor{stringliteral}{"Run "} + Integer.toString(rID) + \textcolor{stringliteral}{" does not exist. Cannot get "} + 
      columnLabel + \textcolor{stringliteral}{"."});
616         \}
617 
618         \textcolor{keywordflow}{return} attrVal;
619 
620     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a48d9e51c1b73064b8f773cdde5113928}\label{classcom_1_1activitytracker_1_1_d_b_manager_a48d9e51c1b73064b8f773cdde5113928}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+Runs@{get\+Runs}}
\index{get\+Runs@{get\+Runs}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+Runs()}{getRuns()}}
{\footnotesize\ttfamily Vector$<$Integer$>$ com.\+activitytracker.\+D\+B\+Manager.\+get\+Runs (\begin{DoxyParamCaption}\item[{final int}]{user\+ID,  }\item[{final java.\+util.\+Date}]{start\+Date,  }\item[{final java.\+util.\+Date}]{end\+Date }\end{DoxyParamCaption})}

Queries the database for all runs by a user with user ID {\itshape user\+ID} between {\itshape start\+Date} and {\itshape end\+Date}.


\begin{DoxyParams}{Parameters}
{\em user\+ID} & The ID of the user whose runs we wish to retrieve. \\
\hline
{\em start\+Date} & The lower bound of the interval we wish to retrieve runs for. \\
\hline
{\em end\+Date} & The uppper bound of the interval we wish to retrieve runs for.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns a vector containing run I\+Ds for each run that meets the search criteria. 
\end{DoxyReturn}


Definition at line 691 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
691                                                                                                            
              \{
692         ResultSet res;
693         Vector<Integer> runs = \textcolor{keyword}{new} Vector<>();
694         \textcolor{keywordflow}{try} \{
695             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(
696                     \textcolor{stringliteral}{"SELECT id FROM Runs WHERE user\_id=? AND date BETWEEN ? AND ?;"});
697             stmt.setInt(1, userID);
698             stmt.setLong(2, startDate.getTime());
699             stmt.setLong(3, endDate.getTime());
700 
701             res = stmt.executeQuery();
702 
703             \textcolor{keywordflow}{if} (res.isClosed())
704                 System.err.println(\textcolor{stringliteral}{"Result set closed; cannot get any data?"});
705 
706             \textcolor{keywordflow}{while} (res.next()) \{
707                 runs.add(res.getInt(\textcolor{stringliteral}{"id"}));
708             \}
709             stmt.close();
710         \}
711         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
712             System.err.println(e.getMessage());
713         \}
714 
715         \textcolor{keywordflow}{return} runs;
716     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a98df66254bec4d74b29cfe468a9fc794}\label{classcom_1_1activitytracker_1_1_d_b_manager_a98df66254bec4d74b29cfe468a9fc794}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+Float\+Attribute@{get\+User\+Float\+Attribute}}
\index{get\+User\+Float\+Attribute@{get\+User\+Float\+Attribute}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+Float\+Attribute()}{getUserFloatAttribute()}}
{\footnotesize\ttfamily float com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+Float\+Attribute (\begin{DoxyParamCaption}\item[{final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}}}]{attribute,  }\item[{final int}]{id }\end{DoxyParamCaption})}

Retrieves a user\textquotesingle{}s attribute in floating point format, when applicable, from the database\textquotesingle{}s Users table.

This method accepts a \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} enumeration type to specify what attribute it is returning from the database. Only certain attributes are accepted by this method, namely those that are stored as real values. Attributes stored as other data types should use the appropriate accessor method.


\begin{DoxyParams}{Parameters}
{\em attribute} & The attribute that the method is supposed to query the DB for and return the value of. Note that only certain \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} types are supported in this method.
\begin{DoxyItemize}
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute_a024206b0dc3261031ef586b3f0fd530c}{User\+Attribute.\+W\+E\+I\+G\+HT}}, this method retrieves the user\textquotesingle{}s weight from the database.
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute_a0a80ca5cce8eb4494c2128bd4291a5b7}{User\+Attribute.\+H\+E\+I\+G\+HT}}, this method retrieves the user\textquotesingle{}s height from the database. 
\end{DoxyItemize}\\
\hline
{\em id} & Unique ID used to associate information in the database to this user.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns a floating point number corresponding to the \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} passed to the method, for the user specified by {\itshape id}. 
\end{DoxyReturn}


Definition at line 253 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
253                                                                                     \{
254         \textcolor{keywordtype}{float} attrVal;
255         ResultSet res;
256         String sqlQuery, columnLabel;
257         \textcolor{keywordflow}{switch} (attribute) \{
258             \textcolor{keywordflow}{case} WEIGHT:
259                 columnLabel = \textcolor{stringliteral}{"weight"};
260                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
261                 \textcolor{keywordflow}{break};
262             \textcolor{keywordflow}{case} HEIGHT:
263                 columnLabel = \textcolor{stringliteral}{"height"};
264                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
265                 \textcolor{keywordflow}{break};
266             \textcolor{keywordflow}{default}:
267                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} AssertionError(\textcolor{stringliteral}{"Incorrect UserAttribute enumeration type passed to method."});
268         \}
269         \textcolor{keywordflow}{try} \{
270             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
271             stmt.setInt(1, \textcolor{keywordtype}{id});
272             res = stmt.executeQuery();
273             attrVal = res.getFloat(columnLabel);
274 
275             stmt.close();
276         \}
277         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
278             System.err.println(e.getMessage());
279             \textcolor{keywordflow}{return} 0.0f;
280         \}
281 
282         \textcolor{keywordflow}{return} attrVal;
283     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a195dcdeabdd00facb19d720976dd3f53}\label{classcom_1_1activitytracker_1_1_d_b_manager_a195dcdeabdd00facb19d720976dd3f53}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+I\+D\+By\+Email@{get\+User\+I\+D\+By\+Email}}
\index{get\+User\+I\+D\+By\+Email@{get\+User\+I\+D\+By\+Email}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+I\+D\+By\+Email()}{getUserIDByEmail()}}
{\footnotesize\ttfamily int com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+I\+D\+By\+Email (\begin{DoxyParamCaption}\item[{final String}]{email\+Address }\end{DoxyParamCaption})}

As we are using the user\textquotesingle{}s email address as their identifying attribute, they will supply this when they log in. Hence, as the database relates everything to the user\textquotesingle{}s unique ID, we must retrieve this ID given the email address.

The logic behind this method relies on the database Users table structure making {\itshape email\+\_\+address} a unique field.


\begin{DoxyParams}{Parameters}
{\em email\+Address} & The user\textquotesingle{}s email address with which they authenticate.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a unique integer corresponding to the row in the database\textquotesingle{}s Users table that stores user information for user with email address {\itshape email\+Address}. 
\end{DoxyReturn}


Definition at line 151 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
151                                                            \{
152         \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = 0;
153         ResultSet res;
154         String sqlQuery = \textcolor{stringliteral}{"SELECT id FROM Users WHERE `email\_address`=?"};
155         \textcolor{keywordflow}{try} \{
156             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
157             stmt.setString(1, emailAddress);
158             res =  stmt.executeQuery();
159             \textcolor{keywordtype}{id} = res.getInt(\textcolor{stringliteral}{"id"});
160 
161             stmt.close();
162         \}
163         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
164             System.err.println(e.getMessage());
165         \}
166 
167         \textcolor{keywordflow}{return} id;
168     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_aab14c61b3f3a17bdea10cab1b5fd9337}\label{classcom_1_1activitytracker_1_1_d_b_manager_aab14c61b3f3a17bdea10cab1b5fd9337}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+Last\+R\+ID@{get\+User\+Last\+R\+ID}}
\index{get\+User\+Last\+R\+ID@{get\+User\+Last\+R\+ID}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+Last\+R\+I\+D()}{getUserLastRID()}}
{\footnotesize\ttfamily int com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+Last\+R\+ID (\begin{DoxyParamCaption}\item[{final int}]{id }\end{DoxyParamCaption})}

Retrieves the last workout ID that the user added as an integer from the database.

This is used because of the format in which the data is supplied. As the only way to denote a new workout is by recieving (0, 0, 0) in the input file, if the input is {\itshape not} (0, 0, 0), we need to update the previously added workout with the latest line. Hence we need some way of storing an identifier for this workout. As this is unique to each user, we have chosen to store this in the Users table of the database.


\begin{DoxyParams}{Parameters}
{\em id} & Unique ID used to associate information in the database to this user. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An integer corresponding to the last row in the Workouts table that the user created. 
\end{DoxyReturn}


Definition at line 391 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
391                                             \{
392         \textcolor{keywordtype}{int} rID = 0;
393         ResultSet res;
394         String columnLabel = \textcolor{stringliteral}{"last\_run"};
395         String sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
396         \textcolor{keywordflow}{try} \{
397             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
398             stmt.setInt(1, \textcolor{keywordtype}{id});
399             res = stmt.executeQuery();
400             rID = res.getInt(columnLabel);
401             stmt.close();
402         \}
403         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
404             System.err.println(e.getMessage());
405         \}
406 
407         \textcolor{keywordflow}{return} rID;
408     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_aeab864b072cc08c0521e80ae1f459ca7}\label{classcom_1_1activitytracker_1_1_d_b_manager_aeab864b072cc08c0521e80ae1f459ca7}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+Pass\+Salt@{get\+User\+Pass\+Salt}}
\index{get\+User\+Pass\+Salt@{get\+User\+Pass\+Salt}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+Pass\+Salt()}{getUserPassSalt()}}
{\footnotesize\ttfamily byte \mbox{[}$\,$\mbox{]} com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+Pass\+Salt (\begin{DoxyParamCaption}\item[{final int}]{id }\end{DoxyParamCaption})}

Retrieves a byte array containing the salt used to encrypt the user\textquotesingle{}s password from the database.

This is necessary because to compare a candidate password supplied by a user to a known (encrypted) password stored in the database, we must encrypt the new candidate password using the same salt as was originally used.


\begin{DoxyParams}{Parameters}
{\em id} & Unique ID used to associate information in the database to this user.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a byte array containing the user\textquotesingle{}s password encryption salt. 
\end{DoxyReturn}


Definition at line 362 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
362                                                 \{
363         byte[] passSalt;
364         ResultSet res;
365         String sqlQuery = \textcolor{stringliteral}{"SELECT password\_salt FROM Users WHERE id=?"};
366         \textcolor{keywordflow}{try} \{
367             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
368             stmt.setInt(1, \textcolor{keywordtype}{id});
369             res = stmt.executeQuery();
370             passSalt = res.getBytes(\textcolor{stringliteral}{"password\_salt"});
371             stmt.close();
372         \}
373         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
374             System.err.println(e.getMessage());
375             \textcolor{keywordflow}{return} null;
376         \}
377         \textcolor{keywordflow}{return} passSalt;
378     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a4e695c111b877cfd1d918602551f65a1}\label{classcom_1_1activitytracker_1_1_d_b_manager_a4e695c111b877cfd1d918602551f65a1}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+Sex@{get\+User\+Sex}}
\index{get\+User\+Sex@{get\+User\+Sex}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+Sex()}{getUserSex()}}
{\footnotesize\ttfamily User.\+Sex com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+Sex (\begin{DoxyParamCaption}\item[{final int}]{id }\end{DoxyParamCaption})}

Retrieves the user\textquotesingle{}s gender from the database.

We have chosen to represent gender in the S\+Q\+Lite database with the data type B\+IT(1), where 1 denotes male and 0 denotes female. Hence, if the database contains 1 this method returns \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_1_1_sex_ad3b626a38bd4615eb621d75b939f412d}{User.\+Sex.\+M\+A\+LE}} and if the database contains 0 then this method returns \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_1_1_sex_a5c22ece8a4df71ed5202cd492990a752}{User.\+Sex.\+F\+E\+M\+A\+LE}}.

At the time of writing, this method is only being used in the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_user}{User}} constructor.


\begin{DoxyParams}{Parameters}
{\em id} & Unique ID used to associate information in the database to this user.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_1_1_sex}{User.\+Sex}} enumeration type corresponding to the user\textquotesingle{}s gender. 
\end{DoxyReturn}


Definition at line 329 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
329                                              \{
330         byte sex;
331         ResultSet res;
332         String sqlQuery = \textcolor{stringliteral}{"SELECT sex FROM Users WHERE id=?"};
333         \textcolor{keywordflow}{try} \{
334             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
335             stmt.setInt(1, \textcolor{keywordtype}{id});
336             res = stmt.executeQuery();
337             sex = res.getByte(\textcolor{stringliteral}{"sex"});
338 
339             stmt.close();
340         \}
341         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
342             System.err.println(e.getMessage());
343             \textcolor{keywordflow}{return} null;
344         \}
345 
346         \textcolor{keywordflow}{if} (sex == (byte) 1)
347             \textcolor{keywordflow}{return} User.Sex.MALE;
348         \textcolor{keywordflow}{else}
349             \textcolor{keywordflow}{return} User.Sex.FEMALE;
350     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a20f726c054d6c8a6fc3ce629d87f1114}\label{classcom_1_1activitytracker_1_1_d_b_manager_a20f726c054d6c8a6fc3ce629d87f1114}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!get\+User\+String\+Attribute@{get\+User\+String\+Attribute}}
\index{get\+User\+String\+Attribute@{get\+User\+String\+Attribute}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{get\+User\+String\+Attribute()}{getUserStringAttribute()}}
{\footnotesize\ttfamily String com.\+activitytracker.\+D\+B\+Manager.\+get\+User\+String\+Attribute (\begin{DoxyParamCaption}\item[{final \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}}}]{attribute,  }\item[{final int}]{id }\end{DoxyParamCaption})}

This method retrieves a string, varchar, text, or char field, when applicable, from the database\textquotesingle{}s Users table.

This method accepts a \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} enumeration type to specify what attribute it is returning from the database. Only certain attributes are accepted by this method, namely those that are stored as string-\/like values. Attributes stored as other data types should use the appropriate accessor method.


\begin{DoxyParams}{Parameters}
{\em attribute} & The attribute that the method is supposed to query the DB for and return the value of. Note that only certain \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute}{User\+Attribute}} types are supported in this method.
\begin{DoxyItemize}
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute_aa893eac0362a28e73a599ce1ba141d40}{User\+Attribute.\+P\+A\+S\+S\+W\+O\+RD}}, this method retrieves the user\textquotesingle{}s encrypted password from the database. Typically this will be used in the following sequence of calls\+:
\begin{DoxyEnumerate}
\item User attempts to authenticate with email and password
\item Their unique ID is retrieved from the database using \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a195dcdeabdd00facb19d720976dd3f53}{D\+B\+Manager\+::get\+User\+I\+D\+By\+Email()}}
\item Their ID is used to retrieve the hash of their password (i.\+e., this method is called)
\item The returned string from this method is compared a \mbox{\hyperlink{classcom_1_1activitytracker_1_1_secure_string}{Secure\+String}} generated from the candidate password supplied by the user when authenticating.
\end{DoxyEnumerate}
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute_aac51a5dfcaaa9e5304d37d74fc888af4}{User\+Attribute.\+N\+A\+ME}}, this method retrieves the user\textquotesingle{}s full name from the database (e.\+g., \char`\"{}\+John Doe\char`\"{}).
\item When {\itshape attribute} is \mbox{\hyperlink{enumcom_1_1activitytracker_1_1_user_attribute_a8b9fa2ebf911262dfa24c683ff2a3b9c}{User\+Attribute.\+E\+M\+A\+I\+L\+\_\+\+A\+D\+D\+R\+E\+SS}}, this method retrieves the user\textquotesingle{}s email address from the database. Note that this is likely somewhat redundant as the user will always be required to authenticate by providing their email address and hence it will already be available to the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_user}{User}} constructor, which is likely what is invoking this method. 
\end{DoxyItemize}\\
\hline
{\em id} & Unique ID used to associate information in the database to this user.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns a string containing attribute specified by the {\itshape attribute} parameter for the user specified by the {\itshape id} parameter. 
\end{DoxyReturn}


Definition at line 199 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
199                                                                                       \{
200         String name;
201         ResultSet res;
202         String sqlQuery, columnLabel;
203         \textcolor{keywordflow}{switch} (attribute) \{
204             \textcolor{keywordflow}{case} PASSWORD:
205                 columnLabel = \textcolor{stringliteral}{"password\_hash"};
206                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
207                 \textcolor{keywordflow}{break};
208             \textcolor{keywordflow}{case} NAME:
209                 columnLabel = \textcolor{stringliteral}{"name"};
210                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
211                 \textcolor{keywordflow}{break};
212             \textcolor{keywordflow}{case} EMAIL\_ADDRESS:
213                 columnLabel = \textcolor{stringliteral}{"email\_address"};
214                 sqlQuery = \textcolor{stringliteral}{"SELECT "} + columnLabel + \textcolor{stringliteral}{" FROM Users WHERE id=?"};
215                 \textcolor{keywordflow}{break};
216             \textcolor{keywordflow}{default}:
217                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} AssertionError(\textcolor{stringliteral}{"Incorrect UserAttribute enumeration type passed to method."});
218         \}
219         \textcolor{keywordflow}{try} \{
220             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
221             stmt.setInt(1, \textcolor{keywordtype}{id});
222             res = stmt.executeQuery();
223             name = res.getString(columnLabel);
224 
225             stmt.close();
226         \}
227         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
228             System.err.println(e.getMessage());
229             \textcolor{keywordflow}{return} null;
230         \}
231 
232         \textcolor{keywordflow}{return} name;
233     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a41df4600bb5901a26a4ea6a7108a70b9}\label{classcom_1_1activitytracker_1_1_d_b_manager_a41df4600bb5901a26a4ea6a7108a70b9}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!init@{init}}
\index{init@{init}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily boolean com.\+activitytracker.\+D\+B\+Manager.\+init (\begin{DoxyParamCaption}\item[{final String}]{db\+U\+RL }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [package]}}

Initializes a connection to the S\+Q\+Lite database.

As no work is done in the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_ac1f558ef56fe02d74fe103a473a15bb5}{D\+B\+Manager()}} constructor, this method should be called immediately after creating the single instance of \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} that the application is to use.

This method will attempt to connect to the database file specified by the {\itshape db\+U\+RL} parameter, creating the file and all required tables if it/they do not exist. You are encouraged to view the source code of this method for more information about the database schema used.

If all of the above is successful, the method returns True. Otherwise, False is returned.


\begin{DoxyParams}{Parameters}
{\em db\+U\+RL} & A file system path to the S\+Q\+Lite database file.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns True if the database can be initialized, or False otherwise. 
\end{DoxyReturn}


Definition at line 814 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
814                                      \{
815         \textcolor{keywordflow}{try} \{
816             \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}} = DriverManager.getConnection(\textcolor{stringliteral}{"jdbc:sqlite:"} + dbURL);
817         \}
818         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
819             System.err.println(e.getMessage());
820             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
821         \}
822         System.out.println(\textcolor{stringliteral}{"Opened database successfully."});
823 
824         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_af9ab112f840e3c803b6b28a2f1a15215}{isEmpty}}()) \{
825             System.out.println(\textcolor{stringliteral}{"Creating tables..."});
826 
827             \textcolor{comment}{// Create users table}
828             String sqlQuery = \textcolor{stringliteral}{"CREATE TABLE USERS ("} +
829                     \textcolor{stringliteral}{"    id            INTEGER PRIMARY KEY ASC AUTOINCREMENT NOT NULL,"} +
830                     \textcolor{stringliteral}{"    email\_address STRING  NOT NULL UNIQUE ON CONFLICT FAIL,"} +
831                     \textcolor{stringliteral}{"    name          STRING  NOT NULL,"} +
832                     \textcolor{stringliteral}{"    date\_of\_birth DATETIME    NOT NULL,"} +
833                     \textcolor{stringliteral}{"    sex           BIT(1)  NOT NULL,"} +
834                     \textcolor{stringliteral}{"    height        REAL    NOT NULL,"} +
835                     \textcolor{stringliteral}{"    weight        REAL    NOT NULL,"} +
836                     \textcolor{stringliteral}{"    password\_hash STRING  NOT NULL,"} +
837                     \textcolor{stringliteral}{"    password\_salt BLOB    NOT NULL,"} +
838                     \textcolor{stringliteral}{"    last\_run      INTEGER NOT NULL DEFAULT 0,"} +
839                     \textcolor{stringliteral}{"    created\_at    DATETIME    NOT NULL"} +
840                     \textcolor{stringliteral}{")"};
841 
842             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a382397e2bdf309901d1c80ff66be69b7}{executeUpdate}}(sqlQuery)) \{
843                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
844             \}
845 
846             \textcolor{comment}{// Create workouts table}
847             sqlQuery = \textcolor{stringliteral}{"CREATE TABLE RUNS ("} +
848                     \textcolor{stringliteral}{"    id                  INTEGER PRIMARY KEY ASC AUTOINCREMENT NOT NULL,"} +
849                     \textcolor{stringliteral}{"    user\_id             INTEGER NOT NULL REFERENCES USERS (id),"} +
850                     \textcolor{stringliteral}{"    date                DATETIME    NOT NULL,"} +
851                     \textcolor{stringliteral}{"    duration            REAL    NOT NULL,"} + \textcolor{comment}{// seconds}
852                     \textcolor{stringliteral}{"    distance            REAL    NOT NULL,"} + \textcolor{comment}{// metres}
853                     \textcolor{stringliteral}{"    altitude\_ascended   REAL    NOT NULL,"} + \textcolor{comment}{// metres}
854                     \textcolor{stringliteral}{"    altitude\_descended  REAL    NOT NULL"} + \textcolor{comment}{// metres}
855                     \textcolor{stringliteral}{")"};
856 
857             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a382397e2bdf309901d1c80ff66be69b7}{executeUpdate}}(sqlQuery)) \{
858                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
859             \}
860 
861         \}
862 
863         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
864     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_af9ab112f840e3c803b6b28a2f1a15215}\label{classcom_1_1activitytracker_1_1_d_b_manager_af9ab112f840e3c803b6b28a2f1a15215}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!is\+Empty@{is\+Empty}}
\index{is\+Empty@{is\+Empty}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{is\+Empty()}{isEmpty()}}
{\footnotesize\ttfamily boolean com.\+activitytracker.\+D\+B\+Manager.\+is\+Empty (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}

Returns a boolean value depending on whether or not the database is populated.

This is done by retrieving tables in the database and checking if this iterator has a next(). If not then there are no tables in the database and we consider it to be empty.

\begin{DoxyReturn}{Returns}
Returns True if there are tables in the database, False otherwise. 
\end{DoxyReturn}


Definition at line 782 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
782                               \{
783 
784         \textcolor{keywordflow}{try} \{
785             \textcolor{keyword}{final} DatabaseMetaData dbmd = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.getMetaData();
786             \textcolor{keyword}{final} String[] types = \{\textcolor{stringliteral}{"TABLE"}\};
787             \textcolor{keyword}{final} ResultSet rs = dbmd.getTables(null, null, \textcolor{stringliteral}{"%"}, types);
788 
789             \textcolor{keywordflow}{return} !rs.next();
790         \}
791         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
792             System.err.println(e.getMessage());
793             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
794         \}
795 
796     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_ae0504a939b6f165aa5c3cca9eb8df049}\label{classcom_1_1activitytracker_1_1_d_b_manager_ae0504a939b6f165aa5c3cca9eb8df049}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!new\+Run@{new\+Run}}
\index{new\+Run@{new\+Run}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{new\+Run()}{newRun()}}
{\footnotesize\ttfamily int com.\+activitytracker.\+D\+B\+Manager.\+new\+Run (\begin{DoxyParamCaption}\item[{final int}]{user\+ID,  }\item[{final java.\+util.\+Date}]{date,  }\item[{final float}]{duration,  }\item[{final float}]{distance,  }\item[{final float}]{altitude\+Ascended,  }\item[{final float}]{altitude\+Descended }\end{DoxyParamCaption})}

Creates a new row in the Runs table with the attributes provided as parameters.

In particular, this method will be called when \mbox{\hyperlink{classcom_1_1activitytracker_1_1_run_a5dea6f1860431103d553ce770382afe0}{Run\+::new\+Run\+Data\+Point()}} receives (0, 0, 0) for ({\itshape duration}, {\itshape distance}, {\itshape altitude}).


\begin{DoxyParams}{Parameters}
{\em user\+ID} & Unique ID used to associate information in the database to this user. \\
\hline
{\em date} & Date that the run was completed. \\
\hline
{\em duration} & Duration of the run in seconds. \\
\hline
{\em distance} & Distance ran in metres. \\
\hline
{\em altitude\+Ascended} & Cumulative altitude climbed in metres. \\
\hline
{\em altitude\+Descended} & Cumulative altitude descended in metres.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns a unique integer corresponding to the new row in the S\+Q\+Lite Workouts table by which the new entry can be identified. 
\end{DoxyReturn}


Definition at line 453 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
454                                                                                    \{
455 
456         \textcolor{keywordtype}{int} rID = 0;
457         ResultSet res;
458         String sqlInsertQuery = \textcolor{stringliteral}{"INSERT INTO Runs ("} +
459                 \textcolor{stringliteral}{"user\_id,"} +
460                 \textcolor{stringliteral}{"date,"} +
461                 \textcolor{stringliteral}{"duration,"} +
462                 \textcolor{stringliteral}{"distance,"} +
463                 \textcolor{stringliteral}{"altitude\_ascended,"} +
464                 \textcolor{stringliteral}{"altitude\_descended"} +
465                 \textcolor{stringliteral}{") VALUES (?, ?, ?, ?, ?, ?)"};
466         String sqlSelectQuery = \textcolor{stringliteral}{"SELECT id FROM Runs WHERE "} +
467                 \textcolor{stringliteral}{"user\_id=? AND "} +
468                 \textcolor{stringliteral}{"date=? AND "} +
469                 \textcolor{stringliteral}{"duration=? AND "} +
470                 \textcolor{stringliteral}{"distance=? AND "} +
471                 \textcolor{stringliteral}{"altitude\_ascended=? AND "} +
472                 \textcolor{stringliteral}{"altitude\_descended=?"};
473 
474         \textcolor{keywordflow}{try} \{
475             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlInsertQuery);
476             stmt.setInt(1, userID);
477             stmt.setLong(2, date.getTime());
478             stmt.setFloat(3, duration);
479             stmt.setFloat(4, distance);
480             stmt.setFloat(5, altitudeAscended);
481             stmt.setFloat(6, altitudeDescended);
482 
483             \textcolor{keywordflow}{if} (stmt.executeUpdate() != 1) \{
484                 System.err.println(\textcolor{stringliteral}{"Run not added to database."});
485             \}
486 
487             stmt.close();
488 
489             \textcolor{comment}{// Pass back in the stuff we just created to get the right row ID}
490             \textcolor{comment}{// Look at a better way of doing this with OUTPUT clause of INPUT statement}
491             stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlSelectQuery);
492             stmt.setInt(1, userID);
493             stmt.setLong(2, date.getTime());
494             stmt.setFloat(3, duration);
495             stmt.setFloat(4, distance);
496             stmt.setFloat(5, altitudeAscended);
497             stmt.setFloat(6, altitudeDescended);
498 
499             res = stmt.executeQuery();
500             rID = res.getInt(\textcolor{stringliteral}{"id"});
501         \}
502         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
503             System.err.println(e.getMessage());
504         \}
505 
506         \textcolor{keywordflow}{return} rID;
507     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a723ac1c573bacdd0b62894357bd65a9b}\label{classcom_1_1activitytracker_1_1_d_b_manager_a723ac1c573bacdd0b62894357bd65a9b}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!run\+Exists@{run\+Exists}}
\index{run\+Exists@{run\+Exists}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{run\+Exists()}{runExists()}}
{\footnotesize\ttfamily boolean com.\+activitytracker.\+D\+B\+Manager.\+run\+Exists (\begin{DoxyParamCaption}\item[{final int}]{r\+ID }\end{DoxyParamCaption})}

Determines if a given run ID exists in the database.


\begin{DoxyParams}{Parameters}
{\em r\+ID} & Unique ID corresponding to the row in the Runs table that we wish to check exists.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
This method returns True if the run row with ID {\itshape W\+O\+ID} exists in the database, or False otherwise. 
\end{DoxyReturn}


Definition at line 652 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
652                                             \{
653         ResultSet res;
654         String sqlQuery = \textcolor{stringliteral}{"SELECT COUNT(*) as count FROM Runs WHERE id=?"};
655         \textcolor{keywordtype}{boolean} exists = \textcolor{keyword}{false};
656         \textcolor{keywordflow}{try} \{
657             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
658             stmt.setInt(1, rID);
659             res = stmt.executeQuery();
660             \textcolor{keywordflow}{switch} (res.getInt(\textcolor{stringliteral}{"count"})) \{
661                 \textcolor{keywordflow}{case} 0:
662                     exists = \textcolor{keyword}{false};
663                     \textcolor{keywordflow}{break};
664                 \textcolor{keywordflow}{case} 1:
665                     exists = \textcolor{keyword}{true};
666                     \textcolor{keywordflow}{break};
667                 \textcolor{keywordflow}{default}:
668                     exists = \textcolor{keyword}{true};
669                     System.err.println(\textcolor{stringliteral}{"More than one run for ID "} +
670                             Integer.toString(rID) + \textcolor{stringliteral}{". Something isn't right."});
671                     \textcolor{keywordflow}{break};
672             \}
673 
674         \}
675         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
676             System.err.println(e.getMessage());
677         \}
678 
679         \textcolor{keywordflow}{return} exists;
680     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_aa088e156858d8d661e2f43c1054c51c8}\label{classcom_1_1activitytracker_1_1_d_b_manager_aa088e156858d8d661e2f43c1054c51c8}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!set\+Run@{set\+Run}}
\index{set\+Run@{set\+Run}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{set\+Run()}{setRun()}}
{\footnotesize\ttfamily void com.\+activitytracker.\+D\+B\+Manager.\+set\+Run (\begin{DoxyParamCaption}\item[{final int}]{r\+ID,  }\item[{final float}]{duration,  }\item[{final float}]{distance,  }\item[{final float}]{altitude\+Ascended,  }\item[{final float}]{altitude\+Descended }\end{DoxyParamCaption})}

Updates a run entry in the database as new information becomes available from the input file.

In particular, this method is called when \mbox{\hyperlink{classcom_1_1activitytracker_1_1_run_a5dea6f1860431103d553ce770382afe0}{Run\+::new\+Run\+Data\+Point()}} receives non-\/(0, 0, 0) input for ({\itshape duration}, {\itshape distance}, {\itshape altitude}).

This method will not be called directly by the application, rather it is called from \mbox{\hyperlink{classcom_1_1activitytracker_1_1_run_a5dea6f1860431103d553ce770382afe0}{Run\+::new\+Run\+Data\+Point()}}. Hence that method will take care of adding/subtracting to/from the current stored values for {\itshape duration}, {\itshape distance}, and {\itshape altitude} --- here we just take the input and put it in the database.


\begin{DoxyParams}{Parameters}
{\em r\+ID} & Unique ID used to identify a run in the database. \\
\hline
{\em duration} & The number of seconds the user\textquotesingle{}s run lasted. \\
\hline
{\em distance} & The cumulative number of metres the user ran. \\
\hline
{\em altitude\+Ascended} & The cumulative number of metres the user climbed. \\
\hline
{\em altitude\+Descended} & The cumulative number of metres the user descended. \\
\hline
\end{DoxyParams}


Definition at line 526 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
527                                                                                            \{
528         String sqlQuery = \textcolor{stringliteral}{"UPDATE Runs SET "} +
529                 \textcolor{stringliteral}{"duration = ?, "} +
530                 \textcolor{stringliteral}{"distance = ?, "} +
531                 \textcolor{stringliteral}{"altitude\_ascended=?, "} +
532                 \textcolor{stringliteral}{"altitude\_descended=? "} +
533                 \textcolor{stringliteral}{"WHERE id=? "};
534         \textcolor{keywordflow}{try} \{
535             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
536             stmt.setFloat(1, duration);
537             stmt.setFloat(2, distance);
538             stmt.setFloat(3, altitudeAscended);
539             stmt.setFloat(4, altitudeDescended);
540             stmt.setInt(5, rID);
541 
542             \textcolor{keywordtype}{int} result = stmt.executeUpdate();
543             System.err.println(Integer.toString(result) + \textcolor{stringliteral}{" rows updated in setRun()."});
544             \textcolor{keywordflow}{if} (result != 1) \{
545                 System.err.println(\textcolor{stringliteral}{"Run not updated in database."});
546             \}
547 
548             stmt.close();
549         \}
550         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
551             System.err.println(e.getMessage());
552         \}
553 
554     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a93b7fc4c2d0083e125852d84f087a8d3}\label{classcom_1_1activitytracker_1_1_d_b_manager_a93b7fc4c2d0083e125852d84f087a8d3}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!set\+User\+Last\+R\+ID@{set\+User\+Last\+R\+ID}}
\index{set\+User\+Last\+R\+ID@{set\+User\+Last\+R\+ID}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{set\+User\+Last\+R\+I\+D()}{setUserLastRID()}}
{\footnotesize\ttfamily void com.\+activitytracker.\+D\+B\+Manager.\+set\+User\+Last\+R\+ID (\begin{DoxyParamCaption}\item[{final int}]{id,  }\item[{final int}]{last\+R\+ID }\end{DoxyParamCaption})}

Updates a user\textquotesingle{}s last run ID in the database.

This method will be used to update the run that a particular user last created. This is used when creating new run as the format of the input file requires that we maintain a record of what run we must update if the next line in the file is {\itshape not} (0, 0, 0).

See \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_aab14c61b3f3a17bdea10cab1b5fd9337}{get\+User\+Last\+R\+I\+D()}} for more information on the user of the {\itshape last\+\_\+run} field in the database.


\begin{DoxyParams}{Parameters}
{\em id} & Unique ID used to associate information in the database to this user. \\
\hline
{\em last\+R\+ID} & Integer corresponding to the last row in the Workouts table that the user with ID {\itshape id} created. \\
\hline
\end{DoxyParams}


Definition at line 422 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
422                                                                 \{
423         String sqlQuery = \textcolor{stringliteral}{"UPDATE Users SET last\_run=? WHERE id=?"};
424         \textcolor{keywordflow}{try} \{
425             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
426             stmt.setInt(1, lastRID);
427             stmt.setInt(2, \textcolor{keywordtype}{id});
428             \textcolor{keywordflow}{if} (stmt.executeUpdate() != 1) \{
429                 System.err.println(\textcolor{stringliteral}{"User's last run was not updated correctly."});
430             \}
431         \}
432         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
433             System.err.println(e.getMessage());
434         \}
435     \}
\end{DoxyCode}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_af05d79f33ecf2920a67d1b9cf82c079f}\label{classcom_1_1activitytracker_1_1_d_b_manager_af05d79f33ecf2920a67d1b9cf82c079f}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!user\+Exists@{user\+Exists}}
\index{user\+Exists@{user\+Exists}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{user\+Exists()}{userExists()}}
{\footnotesize\ttfamily boolean com.\+activitytracker.\+D\+B\+Manager.\+user\+Exists (\begin{DoxyParamCaption}\item[{final String}]{email\+Address }\end{DoxyParamCaption})}

The \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_af05d79f33ecf2920a67d1b9cf82c079f}{D\+B\+Manager\+::user\+Exists()}} method is designed to facilitate the user experience (UX) design choice of users creating one account to the app and logging in with an existing account for future use. This maintains saved (persistent) data and helps enforce the unique constraint placed on the {\itshape email\+\_\+address} field in the database (again, as users are authenticating using their email address as a user name to identify themselves).


\begin{DoxyParams}{Parameters}
{\em email\+Address} & The user\textquotesingle{}s email address for which we are checking existence. We use email address here because this is what the user uses to log in to the app. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the user exists in the database, false otherwise. 
\end{DoxyReturn}


Definition at line 120 of file D\+B\+Manager.\+java.


\begin{DoxyCode}
120                                                           \{
121         String sqlQuery = \textcolor{stringliteral}{"SELECT COUNT(*) AS count FROM Users WHERE `email\_address`=?"};
122         \textcolor{keywordtype}{boolean} exists = \textcolor{keyword}{false};
123 
124         \textcolor{keywordflow}{try} \{
125             PreparedStatement stmt = \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}{m\_conn}}.prepareStatement(sqlQuery);
126             stmt.setString(1, emailAddress);
127             ResultSet res = stmt.executeQuery();
128             exists = res.getInt(\textcolor{stringliteral}{"count"}) > 0;
129 
130             stmt.close();
131         \}
132         \textcolor{keywordflow}{catch} (\textcolor{keyword}{final} SQLException e) \{
133             System.err.println(e.getMessage());
134         \}
135 
136         \textcolor{keywordflow}{return} exists;
137     \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}\label{classcom_1_1activitytracker_1_1_d_b_manager_a064088d13ac09eb147fdc19268771521}} 
\index{com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}!m\+\_\+conn@{m\+\_\+conn}}
\index{m\+\_\+conn@{m\+\_\+conn}!com\+::activitytracker\+::\+D\+B\+Manager@{com\+::activitytracker\+::\+D\+B\+Manager}}
\subsubsection{\texorpdfstring{m\+\_\+conn}{m\_conn}}
{\footnotesize\ttfamily Connection com.\+activitytracker.\+D\+B\+Manager.\+m\+\_\+conn = null\hspace{0.3cm}{\ttfamily [private]}}

The {\itshape m\+\_\+conn} variable in the \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager}{D\+B\+Manager}} class is initially assigned the value of {\itshape null}.

When \mbox{\hyperlink{classcom_1_1activitytracker_1_1_d_b_manager_a41df4600bb5901a26a4ea6a7108a70b9}{D\+B\+Manager\+::init()}} is invoked, it is made to be the connection to the database and is subsequently used each time a new S\+QL statement is created. 

Definition at line 37 of file D\+B\+Manager.\+java.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
app/src/com/activitytracker/\mbox{\hyperlink{_d_b_manager_8java}{D\+B\+Manager.\+java}}\end{DoxyCompactItemize}
